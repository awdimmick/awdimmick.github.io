<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>CodeCopy - Decoded text</title>
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
    <link rel="icon" type="image/x-icon" href="favicon.ico" />

    <!-- Bootstrap CSS -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css"
      integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T"
      crossorigin="anonymous"
    />

    <!-- Highlight.js CSS theme -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css"
    />

    <link rel="stylesheet" href="codecopy.css" />

    <!-- Highlight.js library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/lz-string/libs/lz-string.min.js"></script>
    <script src="codecopy.js"></script>
  </head>

  <body onload="page_load();">
    <div class="container" id="container" style="margin-top: 10px">
      <p
        id="dark_mode_label"
        onclick="toggle_dark_mode();"
        style="cursor: pointer; font-size: small; float: right"
      >
        Turn on dark mode
      </p>
      <p style="margin-bottom: -0.5em; padding-top: 2em">Mr Dimmick's</p>
      <a
        href="index.html"
        style="
          :hover {
            text-decoration: none;
          }
        "
        ><h1>CodeCopy</h1></a
      >
      <p style="font-style: italic; font-size: 0.8em">
        A simple tool for encoding code snippets as URLs to share with people
        and devices
      </p>
      <h3>Decoded text:</h3>
      <pre><code id="decodedCode" class="hljs"></code></pre>
      <button id="copyBtn">Copy to Clipboard</button>
      <p id="copyMessage">Code copied to clipboard!</p>
    </div>

    <script>
      let dark_mode = false;

      function page_load() {
        toggle_dark_mode();
        // Decode on page load
        const encoded = getQueryParam("enc");
        const decoded = decodeText(encoded);

        const codeBlock = document.getElementById("decodedCode");
        codeBlock.textContent = decoded;

        // Apply syntax highlighting
        hljs.highlightElement(codeBlock);

        // Copy button
        const copyBtn = document.getElementById("copyBtn");
        const copyMessage = document.getElementById("copyMessage");

        copyBtn.addEventListener("click", async () => {
          try {
            await navigator.clipboard.writeText(decoded);
            copyMessage.style.display = "block";
            setTimeout(() => {
              copyMessage.style.display = "none";
            }, 2000);
          } catch (err) {
            alert("Failed to copy text: " + err);
          }
        });
      }
    </script>
  </body>
</html>
