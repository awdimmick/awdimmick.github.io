<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>CodeCopy - Decoded text</title>
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
    <link rel="icon" type="image/x-icon" href="favicon.ico" />

    <!-- Bootstrap CSS -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css"
      integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T"
      crossorigin="anonymous"
    />

    <!-- Highlight.js CSS theme -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css"
    />
    <style>
      body.dark_mode {
        background-color: rgba(27, 30, 51, 0.94);
        color: white;
      }

      h1.dark_mode {
        color: #ffd500;
      }
      body {
        font-family: sans-serif;
      }
      pre {
        padding: 12px;
        border-radius: 6px;
        overflow-x: auto;
        font-size: 14px;
      }
      #copyMessage {
        color: green;
        font-weight: bold;
        display: none;
        margin-top: 10px;
      }
    </style>
  </head>

  <body onload="page_load();">
    <div class="container" id="container" style="margin-top: 10px">
      <p
        id="dark_mode_label"
        onclick="toggle_dark_mode();"
        style="cursor: pointer; font-size: small; float: right"
      >
        Turn on dark mode
      </p>
      <p style="margin-bottom: -0.5em; padding-top: 2em">Mr Dimmick's</p>
      <a href="encode.html" style=":hover {text-decoration:none;}"><h1>CodeCopy</h1></a>
      <p style="font-style: italic; font-size: 0.8em">
        A simple tool for encoding code snippets as URLs to share with people
        and devices
      </p>
      <h3>Decoded text:</h3>
      <pre><code id="decodedCode" class="hljs"></code></pre>
      <button id="copyBtn">Copy to Clipboard</button>
      <p id="copyMessage">Code copied to clipboard!</p>
    </div>
    <!-- Highlight.js library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script>
      let dark_mode = false;  

      function page_load(){
        toggle_dark_mode();
      }

      function getQueryParam(name) {
        const params = new URLSearchParams(window.location.search);
        return params.get(name);
      }

      function decodeText(encoded) {
        if (!encoded) return "";
        return decodeURIComponent(encoded);
      }

      // Decode on page load
      const encoded = getQueryParam("enc");
      const decoded = decodeText(encoded);

      const codeBlock = document.getElementById("decodedCode");
      codeBlock.textContent = decoded;

      // Apply syntax highlighting
      hljs.highlightElement(codeBlock);

      // Copy button
      const copyBtn = document.getElementById("copyBtn");
      const copyMessage = document.getElementById("copyMessage");

      copyBtn.addEventListener("click", async () => {
        try {
          await navigator.clipboard.writeText(decoded);
          copyMessage.style.display = "block";
          setTimeout(() => {
            copyMessage.style.display = "none";
          }, 2000);
        } catch (err) {
          alert("Failed to copy text: " + err);
        }
      });
      function toggle_dark_mode() {
        dark_mode = !dark_mode;

        if (dark_mode) {
          document.getElementsByTagName("h1")[0].classList.add("dark_mode");
          document.getElementsByTagName("body")[0].classList.add("dark_mode");
          document.getElementById("dark_mode_label").innerText =
            "Turn off dark mode";
        } else {
          document.getElementsByTagName("h1")[0].classList.remove("dark_mode");
          document
            .getElementsByTagName("body")[0]
            .classList.remove("dark_mode");
          document.getElementById("dark_mode_label").innerText =
            "Turn on dark mode";
        }
      }
    </script>
  </body>
</html>
